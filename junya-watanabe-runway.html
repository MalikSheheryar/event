<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Junya Watanabe Runway Archives</title>

    <!-- A-Frame MUST load first -->
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>

    <!-- Wait for A-Frame to load before other scripts -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Make sure A-Frame is fully loaded before loading other scripts
        if (typeof AFRAME !== 'undefined') {
          // Load remaining scripts
          loadScriptsSequentially([
            'https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js',
            'https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js',
            'naf-components.js',
            'junya.js',
            'top-bar.js',
          ])
        } else {
          console.error('A-Frame not loaded properly!')
        }
      })

      // Function to load scripts in sequence
      function loadScriptsSequentially(scripts) {
        if (scripts.length === 0) return

        const scriptSrc = scripts.shift()
        const script = document.createElement('script')
        script.src = scriptSrc

        script.onload = function () {
          console.log(`Loaded: ${scriptSrc}`)
          if (scripts.length > 0) {
            loadScriptsSequentially(scripts)
          }
        }

        script.onerror = function () {
          console.error(`Failed to load: ${scriptSrc}`)
          if (scripts.length > 0) {
            loadScriptsSequentially(scripts)
          }
        }

        document.head.appendChild(script)
      }

      // Billboard component - defined after A-Frame loads
      AFRAME.registerComponent('billboard', {
        tick: function () {
          const camera = this.el.sceneEl.camera
          if (!camera) return

          const object3D = this.el.object3D

          // Get the camera's world position
          const cameraWorldPos = new THREE.Vector3()
          camera.getWorldPosition(cameraWorldPos)

          // Make the entity face the camera's world position
          object3D.lookAt(cameraWorldPos)

          // Correct rotation to keep the image upright
          object3D.rotation.x = 0
          object3D.rotation.z = 0
        },
      })
    </script>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="junya.css" />
    <link rel="stylesheet" href="w-black-topbar.css" />
    <link rel="icon" type="image/x-icon" href="Assets/landing/favicon.ico" />
  </head>
  <body>
    <div class="top-bar">
      <!-- Left-Side Buttons Container -->
      <div class="left-buttons">
        <button class="menu-button event" onclick="openSidebar()">EVENT</button>
        <button class="menu-button credits">Credits</button>
      </div>
      <div class="center-text">Junya Watanabe Runway Archives 1993-2022</div>
      <!-- Right-Aligned Buttons Container -->
      <div class="right-buttons">
        <button class="menu-button back">
          <a href="junya-watanabe-runway-invite.html">Back</a>
        </button>
        <button class="menu-button next">
          <a href="martine-rose-nike.html">Next</a>
        </button>
        <button class="menu-button navigate">How to Move?</button>
      </div>
    </div>
    <div id="index" class="indexbar">
      <button class="index-close-btn" onclick="closeSidebar()">âœ–</button>
      <p>Sidebar Content Goes Here</p>
    </div>
    <!-- TOP BAR END -->
    <div class="fixed-left-text"></div>
    <div class="fixed-text" id="scene-text"></div>
    <div class="title-line"></div>

    <a-scene>
      <a-assets>
        <!-- Add avatar model with proper ID for networking -->
        <a-asset-item
          id="avatarModel"
          src="Assets/landing/yellow.gltf"
        ></a-asset-item>
        <img
          id="text-a"
          src="Assets/junya-watanabe-runway-archives/junya-text-1.png"
        />
        <img
          id="text-b"
          src="Assets/junya-watanabe-runway-archives/junya-text-2.png"
        />
        <img
          id="text-c"
          src="Assets/junya-watanabe-runway-archives/junya-text-3.png"
        />
        <img
          id="text-d"
          src="Assets/junya-watanabe-runway-archives/junya-text-4.png"
        />
        <img
          id="text-e"
          src="Assets/junya-watanabe-runway-archives/junya-text-5.png"
        />
        <img
          id="text-f"
          src="Assets/junya-watanabe-runway-archives/junya-text-6.png"
        />
        <img
          id="text-g"
          src="Assets/junya-watanabe-runway-archives/junya-text-7.png"
        />
        <img
          id="text-h"
          src="Assets/junya-watanabe-runway-archives/junya-text-8.png"
        />
        <img
          id="text-i"
          src="Assets/junya-watanabe-runway-archives/junya-text-9.png"
        />
        <img
          id="text-j"
          src="Assets/junya-watanabe-runway-archives/junya-text-10.png"
        />

        <!-- All your existing asset items... -->
        <img
          id="a1"
          src="Assets/junya-watanabe-runway-archives/JW1_2_IMGCentury.png"
        />
        <img
          id="a2"
          src="Assets/junya-watanabe-runway-archives/JW1_3_IMGCentury.png"
        />
        <img
          id="a3"
          src="Assets/junya-watanabe-runway-archives/JW1_4_IMGCentury.png"
        />
        <img
          id="a4"
          src="Assets/junya-watanabe-runway-archives/JW1_5_IMGCentury.png"
        />

        <img
          id="b1"
          src="Assets/junya-watanabe-runway-archives/JW2_1_IMGCentury.png"
        />
        <img
          id="b2"
          src="Assets/junya-watanabe-runway-archives/JW2_2_IMGCentury.png"
        />
        <img
          id="b4"
          src="Assets/junya-watanabe-runway-archives/JW2_4_IMGCentury.png"
        />

        <img
          id="c1"
          src="Assets/junya-watanabe-runway-archives/JW3_1_IMGCentury.png"
        />
        <img
          id="c2"
          src="Assets/junya-watanabe-runway-archives/JW3_2_IMGCentury.png"
        />
        <img
          id="c3"
          src="Assets/junya-watanabe-runway-archives/JW3_3_IMGCentury.png"
        />
        <img
          id="c4"
          src="Assets/junya-watanabe-runway-archives/JW3_4_IMGCentury.png"
        />

        <img
          id="d1"
          src="Assets/junya-watanabe-runway-archives/JW4_1_IMGCentury.png"
        />
        <img
          id="d2"
          src="Assets/junya-watanabe-runway-archives/JW4_2_IMGCentury.png"
        />
        <img
          id="d3"
          src="Assets/junya-watanabe-runway-archives/JW4_3_IMGCentury.png"
        />
        <img
          id="d4"
          src="Assets/junya-watanabe-runway-archives/JW4_4_IMGCentury.png"
        />

        <img
          id="e1"
          src="Assets/junya-watanabe-runway-archives/JW5_1_IMGCentury.png"
        />
        <img
          id="e2"
          src="Assets/junya-watanabe-runway-archives/JW5_2_IMGCentury.png"
        />
        <img
          id="e3"
          src="Assets/junya-watanabe-runway-archives/JW5_3_IMGCentury.png"
        />
        <img
          id="e4"
          src="Assets/junya-watanabe-runway-archives/JW5_4_IMGCentury.png"
        />

        <img
          id="f1"
          src="Assets/junya-watanabe-runway-archives/JW6_1_IMGCentury.png"
        />
        <img
          id="f2"
          src="Assets/junya-watanabe-runway-archives/JW6_2_IMGCentury.png"
        />
        <img
          id="f3"
          src="Assets/junya-watanabe-runway-archives/JW6_3_IMGCentury.png"
        />
        <img
          id="f4"
          src="Assets/junya-watanabe-runway-archives/JW6_4_IMGCentury.png"
        />

        <img
          id="g1"
          src="Assets/junya-watanabe-runway-archives/JW7_1_IMGCentury.png"
        />
        <img
          id="g2"
          src="Assets/junya-watanabe-runway-archives/JW7_2_IMGCentury.png"
        />
        <img
          id="g3"
          src="Assets/junya-watanabe-runway-archives/JW7_3_IMGCentury.png"
        />
        <img
          id="g4"
          src="Assets/junya-watanabe-runway-archives/JW7_4_IMGCentury.png"
        />

        <img
          id="h1"
          src="Assets/junya-watanabe-runway-archives/JW8_1_IMGCentury.png"
        />
        <img
          id="h2"
          src="Assets/junya-watanabe-runway-archives/JW8_2_IMGCentury.png"
        />
        <img
          id="h3"
          src="Assets/junya-watanabe-runway-archives/JW8_3_IMGCentury.png"
        />
        <img
          id="h4"
          src="Assets/junya-watanabe-runway-archives/JW8_4_IMGCentury.png"
        />

        <img
          id="i1"
          src="Assets/junya-watanabe-runway-archives/JW9_1_IMGCentury.png"
        />
        <img
          id="i2"
          src="Assets/junya-watanabe-runway-archives/JW9_2_IMGCentury.png"
        />
        <img
          id="i3"
          src="Assets/junya-watanabe-runway-archives/JW9_3_IMGCentury.png"
        />
        <img
          id="i4"
          src="Assets/junya-watanabe-runway-archives/JW9_4_IMGCentury.png"
        />

        <img
          id="j1"
          src="Assets/junya-watanabe-runway-archives/JW10_1_IMGCentury.png"
        />
        <img
          id="j2"
          src="Assets/junya-watanabe-runway-archives/JW10_2_IMGCentury.png"
        />
        <img
          id="j3"
          src="Assets/junya-watanabe-runway-archives/JW10_3_IMGCentury.png"
        />
        <img
          id="j4"
          src="Assets/junya-watanabe-runway-archives/JW10_4_IMGCentury.png"
        />
      </a-assets>

      <!-- SCENE CONTENT -->
      <a-entity
        class="xyz"
        material="transparent: true"
        position="0 10 5"
      ></a-entity>

      <!-- Remove or comment out this static avatar, as it will be replaced by networked avatars -->
      <!-- <a-gltf-model
        src="Assets/landing/yellow.gltf"
        position="0 1 -5"
        scale=""
      ></a-gltf-model> -->

      <!-- AW 93 -->
      <a-image
        src="#text-a"
        position="-42 10 2"
        rotation="0 10 0"
        width="66"
        height="31.5"
        visible="false"
      ></a-image>
      <a-image
        src="#a4"
        position="-20 10 -1"
        rotation="0 10 0"
        width="20"
        height="30"
      ></a-image>
      <a-image
        src="#a3"
        position="-21 11 0"
        rotation="-2 10 0"
        width="19.5"
        height="29.5"
        billboard
      ></a-image>
      <a-image
        src="#a2"
        position="-21 11 1"
        rotation="-2 10 0"
        width="19.5"
        height="29.5"
        billboard
      ></a-image>
      <a-image
        src="#a1"
        position="-21 11 2"
        rotation="-2 10 0"
        width="19.5"
        height="29.5"
        billboard
      ></a-image>

      <!-- AW 00 -->
      <a-image
        src="#text-b"
        position="-37.5 10 -38"
        rotation="0 10 0"
        width="66"
        height="31.5"
        visible="false"
      ></a-image>
      <a-image
        src="#b4"
        position="-15 10 -41"
        rotation="0 10 0"
        width="20"
        height="30"
      ></a-image>
      <a-image
        src="#b2"
        position="-15 10 -40"
        rotation="-2 0 0"
        width="20"
        height="30"
        billboard
      ></a-image>
      <a-image
        src="#b2"
        position="-15 10 -39"
        rotation="-2 0 0"
        width="20"
        height="30"
        billboard
      ></a-image>
      <a-image
        src="#b1"
        position="-15 10 -38"
        rotation="-2 0 0"
        width="20"
        height="30"
        billboard
      ></a-image>

      <!-- Keep all your existing scene images... -->

      <a-sky color="#000"></a-sky>

      <!-- Camera rig structure for networking -->
      <a-entity id="cameraRig" position="-20 12 49" rotation="0 0 0">
        <a-camera
          wasd-controls="acceleration: 10; fly: true;"
          look-controls
          id="mainCamera"
        >
        </a-camera>
      </a-entity>

      <!-- VR rig with identified ID for networking -->
      <a-entity id="rig" movement-controls="speed: 0.1;" universal-controls>
        <a-entity
          camera
          look-controls="pointerLockEnabled: false"
          position="0 1.6 0"
        ></a-entity>
        <a-entity oculus-touch-controls="hand: left"></a-entity>
        <a-entity oculus-touch-controls="hand: right"></a-entity>
      </a-entity>
    </a-scene>

    <!-- Scene update script -->
    <script src="junya-scene-updater.js"></script>

    <!-- Initialization script -->
    <script>
      // This will ensure networking is initialized when everything is ready
      document.addEventListener('DOMContentLoaded', function () {
        // Wait for A-Frame and all components to initialize
        document
          .querySelector('a-scene')
          .addEventListener('loaded', function () {
            console.log(
              '[CLIENT] A-Frame scene fully loaded - initializing networking'
            )

            // Wait a moment to ensure all components are ready
            setTimeout(function () {
              console.log('[CLIENT] Ready to initialize networking')

              // Make sure the camera rig has the animate-camera component
              const cameraRig = document.querySelector('#cameraRig')
              if (
                cameraRig &&
                typeof AFRAME.components['animate-camera'] !== 'undefined'
              ) {
                console.log('[CLIENT] Adding animate-camera component')
                if (!cameraRig.hasAttribute('animate-camera')) {
                  cameraRig.setAttribute('animate-camera', '')
                }
              } else {
                console.error('[CLIENT] Could not initialize animate-camera')

                // Fallback if animate-camera isn't available
                if (typeof setupNetworkedWorld === 'function') {
                  console.log('[CLIENT] Using direct networking initialization')
                  setupNetworkedWorld('junya-watanabe', '#cameraRig')
                } else {
                  console.error(
                    '[CLIENT] setupNetworkedWorld function not found!'
                  )
                }
              }
            }, 1000)
          })
      })
    </script>
  </body>
</html>
